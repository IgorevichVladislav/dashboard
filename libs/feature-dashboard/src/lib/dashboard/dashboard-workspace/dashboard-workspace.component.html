<div class="dashboard__header">
  <h1 class="dashboard__title">{{ currentProject()?.name }}</h1>

  <button
    mat-raised-button
    [matMenuTriggerFor]="menu"
    [disabled]="availableWidgets().length === 0">
    <mat-icon>add_circle</mat-icon>
    Добавить виджет
  </button>
</div>

<!-- Меню добавления -->
<mat-menu #menu="matMenu">
  @for (widget of availableWidgets(); track widget.type) {
    <button mat-menu-item (click)="addWidget(widget.type)">
      <mat-icon>widgets</mat-icon>
      {{ widget.name }}
    </button>
  }
</mat-menu>

<!-- Контейнер для drag'n'drop -->
<div cdkDropListGroup class="dashboard-controls">

  <div
    #dashboardBody
    cdkDropList
    [cdkDropListData]="addedWidgetTypes()"
    (cdkDropListDropped)="drop($event)"
    class="widgets-container"
  >

    @for (widgetType of addedWidgetTypes(); track widgetType; let i = $index) {
      <div cdkDrag
           cdkDragPreviewContainer="parent"
           class="widget-item">
        <ng-container #widgetContainer></ng-container>
        <div *cdkDragPlaceholder class="drag-placeholder"></div>
      </div>
    }
    <!-- Пустое состояние -->
    @if (addedWidgetTypes().length === 0) {
      <div class="empty-state">
        <mat-icon>dashboard</mat-icon>
        <p>Добавьте виджеты для отображения данных</p>
      </div>
    }
  </div>
</div>

<!--<div #widgetContainerRef></div>-->
<!--<div class="dashboard__body-wrapper"-->

<!--     cdkDropListGroup>-->

<!--  <div #widgetContainerRef></div>-->
<!--  <div-->
<!--    #dashboardBody-->
<!--    class="dashboard__body"-->
<!--  >-->
<!--    @if (widgets(); as widgets) {-->
<!--      @for (widget of widgets; track widget.id) {-->

<!--        <div-->
<!--          cdkDropList-->
<!--          [cdkDropListData]="widget.id"-->
<!--          (cdkDropListDropped)="drop($event)"-->
<!--        >-->

<!--          <div class="dashboard__item" cdkDrag [cdkDragData]="widget">-->
<!--            <lib-progress-widget-->
<!--              [data]="widget"-->
<!--              (deleteWidget)="deleteById(widget.id)">-->

<!--            </lib-progress-widget>-->

<!--            <div *cdkDragPlaceholder class="drag-placeholder"></div>-->
<!--          </div>-->

<!--        </div>-->
<!--      }-->
<!--    }-->
<!--  </div>-->
<!--</div>-->


